(self.webpackChunkhey_dj=self.webpackChunkhey_dj||[]).push([[871],{1871:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>v});var n=s(2791),r=s(7689),a=s(9942),i=s(5055),c=s(5178),o=s(4802),l=s(2469),d=s(7022),h=s(5736),u=s(9140),m=s(2591),x=s(3360),j=s(3855),f=s(184);const v=()=>{const[e,t]=(0,n.useState)({totalUsers:0,genreChoices:0,males:0,females:0}),[s,v]=(0,n.useState)([]),[p,b]=(0,n.useState)([]),[g,y]=(0,n.useState)(!0),[w,N]=(0,n.useState)(null),[S,Z]=(0,n.useState)(!1),[k,L]=(0,n.useState)(!1),[C,E]=(0,n.useState)(null),[A,U]=(0,n.useState)(!1),[$,R]=(0,n.useState)(null),[T,D]=(0,n.useState)(""),z=(0,r.s0)(),B=(0,n.useCallback)((async()=>{try{U(!0);const[e]=await Promise.all([(0,a.U2)("/user/user-stats")]);t(e),E(new Date)}catch(w){N((0,i.z)(w,"Failed to fetch statistics"))}finally{U(!1)}}),[]),M=(0,n.useCallback)((async()=>{try{const e=await(0,a.U2)("/events/mine");b(e)}catch(w){N((0,i.z)(w,"Failed to fetch events"))}}),[$]);(0,n.useEffect)((()=>{(async()=>{try{var e;const t=await(0,a.U2)("/user/check-auth");Z(t.isAdmin);const s=t.user&&t.user._id;R(s&&"object"===typeof s&&"toString"in s&&s.toString?s.toString():String((null===(e=t.user)||void 0===e?void 0:e._id)||""))}catch(w){N((0,i.z)(w,"An unknown error occurred"))}})()}),[]),(0,n.useEffect)((()=>{if(!S||!$)return;(async()=>{y(!0);try{await Promise.all([B(),M()])}catch(w){N((0,i.z)(w,"An unknown error occurred"))}finally{y(!1)}})()}),[S,$,B,M]),(0,n.useEffect)((()=>{if(!S||!$||k)return;L(!0);const e=setInterval((async()=>{await Promise.all([B(),M()])}),5e3);return()=>{clearInterval(e),L(!1)}}),[S,$,B,M,k]);const _=(e,t)=>!t||t<=0?"0%":`${Math.round(e/t*100)}%`,G=(()=>{const e=new Map;for(const t of p){if(Array.isArray(t.genreStats)&&t.genreStats.length>0)for(const s of t.genreStats)e.set(s.genreName,(e.get(s.genreName)||0)+s.count);else for(const s of t.registeredUsers||[]){const t=(s.genreChoice||"").trim();t&&e.set(t,(e.get(t)||0)+1)}}return e})(),O=Array.from(G.values()).reduce(((e,t)=>e+t),0);return g?(0,f.jsx)(c.Z,{fullScreen:!0,variant:"bootstrap"}):w?(0,f.jsx)(l.Z,{variant:"danger",children:w}):S?(0,f.jsxs)(d.Z,{className:"mb-5",children:[(0,f.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,f.jsx)("h1",{children:"DJ Event Management Page"}),C&&(0,f.jsxs)("div",{className:"d-flex align-items-center",children:[A?(0,f.jsxs)(h.Z,{bg:"info",className:"me-2",children:[(0,f.jsx)(c.Z,{size:12,variant:"bootstrap"}),(0,f.jsx)("span",{className:"ms-2",children:"Updating..."})]}):(0,f.jsxs)(h.Z,{bg:"success",className:"me-2",children:[(0,f.jsx)("i",{className:"bi bi-check-circle-fill me-1"}),"Live"]}),(0,f.jsxs)("small",{className:"text-muted",children:["Last updated: ",C.toLocaleTimeString()]})]})]}),(0,f.jsx)(u.Z,{className:"mb-4 shadow-sm",children:(0,f.jsxs)(u.Z.Body,{children:[(0,f.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,f.jsx)(u.Z.Title,{children:"User Statistics"}),A&&(0,f.jsx)(c.Z,{size:16,variant:"bootstrap"})]}),(0,f.jsxs)(m.Z,{striped:!0,hover:!0,responsive:!0,children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"Total Users"}),(0,f.jsx)("th",{children:"Genre Choices"}),(0,f.jsx)("th",{children:"Males"}),(0,f.jsx)("th",{children:"Females"})]})}),(0,f.jsx)("tbody",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{children:e.totalUsers}),(0,f.jsx)("td",{children:e.genreChoices}),(0,f.jsx)("td",{children:e.males}),(0,f.jsx)("td",{children:e.females})]})})]})]})}),(0,f.jsx)(u.Z,{className:"mb-4 shadow-sm",children:(0,f.jsxs)(u.Z.Body,{children:[(0,f.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,f.jsx)(u.Z.Title,{children:"Genre Statistics"}),A&&(0,f.jsx)(c.Z,{size:16,variant:"bootstrap"})]}),(0,f.jsxs)(m.Z,{striped:!0,hover:!0,responsive:!0,children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"Genre"}),(0,f.jsx)("th",{children:"Count"}),(0,f.jsx)("th",{children:"Percent"})]})}),(0,f.jsx)("tbody",{children:Array.from(G.entries()).map(((e,t)=>{let[s,n]=e;return(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{children:s}),(0,f.jsx)("td",{children:n}),(0,f.jsx)("td",{children:_(n,O)})]},t)}))})]})]})}),(0,f.jsx)(u.Z,{className:"mb-4 shadow-sm",children:(0,f.jsxs)(u.Z.Body,{children:[(0,f.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,f.jsx)(u.Z.Title,{className:"mb-0",children:"Events History"}),(0,f.jsxs)(x.Z,{variant:"primary",onClick:async()=>{try{const e=await(0,a.U2)("/user/download-user-details"),t=new Blob([e],{type:"text/csv"});(0,o.saveAs)(t,"user-details.csv")}catch(w){N((0,i.z)(w,"An error occurred"))}},children:[(0,f.jsx)("i",{className:"bi bi-download me-2"}),"Download User Details"]})]}),(0,f.jsx)(j.Z,{className:"mb-3",children:(0,f.jsx)(j.Z.Control,{type:"text",placeholder:"Search events by name or location...",value:T,onChange:e=>D(e.target.value)})}),p.filter((e=>{const t=T.trim().toLowerCase();if(!t)return!0;const s=(e.eventName||"").toLowerCase(),n=(e.eventLocation||"").toLowerCase(),r=new Date(e.eventDate).toLocaleDateString().toLowerCase();return s.includes(t)||n.includes(t)||r.includes(t)})).map((e=>(0,f.jsx)(u.Z,{className:"mb-4",children:(0,f.jsxs)(u.Z.Body,{children:[(0,f.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h5",{className:"mb-1",children:e.eventName}),(0,f.jsxs)("p",{className:"text-muted mb-0",children:[e.eventLocation," - ",new Date(e.eventDate).toLocaleDateString()]})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)(x.Z,{variant:"primary",onClick:()=>{return t=e._id,z(`/events/edit/${t}`);var t},className:"me-2",children:[(0,f.jsx)("i",{className:"bi bi-pencil-fill me-2"}),"Edit"]}),(0,f.jsxs)(x.Z,{variant:"danger",onClick:()=>(async e=>{try{await(0,a.IV)(`/events/${e}`),await M()}catch(w){N((0,i.z)(w,"An error occurred"))}})(e._id),children:[(0,f.jsx)("i",{className:"bi bi-trash-fill me-2"}),"Delete"]})]})]}),(0,f.jsxs)("div",{className:"mb-3",children:[(0,f.jsx)("h6",{children:"Event Genre Statistics:"}),(0,f.jsxs)(m.Z,{striped:!0,hover:!0,responsive:!0,size:"sm",children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"Genre"}),(0,f.jsx)("th",{children:"Count"}),(0,f.jsx)("th",{children:"Percent"})]})}),(0,f.jsx)("tbody",{children:(()=>{const t=(e.genreStats||[]).reduce(((e,t)=>e+t.count),0);return(e.genreStats||[]).map(((e,s)=>(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{children:e.genreName}),(0,f.jsx)("td",{children:e.count}),(0,f.jsx)("td",{children:_(e.count,t)})]},s)))})()})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h6",{children:"Registered Guests:"}),(0,f.jsxs)(m.Z,{striped:!0,hover:!0,responsive:!0,size:"sm",children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"Guest Name"}),(0,f.jsx)("th",{children:"Genre Choice"}),(0,f.jsx)("th",{children:"YouTube Link"})]})}),(0,f.jsx)("tbody",{children:e.registeredUsers.map(((e,t)=>(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{children:e.name}),(0,f.jsx)("td",{children:e.genreChoice}),(0,f.jsx)("td",{children:e.youtubeLink?(0,f.jsxs)("a",{href:e.youtubeLink,target:"_blank",rel:"noopener noreferrer",children:[(0,f.jsx)("i",{className:"bi bi-youtube text-danger me-2"}),"View"]}):(0,f.jsx)("span",{className:"text-muted",children:"No link provided"})})]},t)))})]})]})]})},e._id)))]})})]}):(0,f.jsx)(l.Z,{variant:"warning",children:"You do not have permission to view this page."})}},4802:function(e,t,s){var n,r,a;r=[],void 0===(a="function"===typeof(n=function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function n(e,t,s){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){o(n.response,t,s)},n.onerror=function(){console.error("could not download file")},n.send()}function r(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof s.g&&s.g.global===s.g?s.g:void 0,c=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!c?function(e,t,s){var c=i.URL||i.webkitURL,o=document.createElement("a");t=t||e.name||"download",o.download=t,o.rel="noopener","string"==typeof e?(o.href=e,o.origin===location.origin?a(o):r(o.href)?n(e,t,s):a(o,o.target="_blank")):(o.href=c.createObjectURL(e),setTimeout((function(){c.revokeObjectURL(o.href)}),4e4),setTimeout((function(){a(o)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,s,i){if(s=s||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,i),s);else if(r(e))n(e,s,i);else{var c=document.createElement("a");c.href=e,c.target="_blank",setTimeout((function(){a(c)}))}}:function(e,t,s,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return n(e,t,s);var a="application/octet-stream"===e.type,o=/constructor/i.test(i.HTMLElement)||i.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||a&&o||c)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},d.readAsDataURL(e)}else{var h=i.URL||i.webkitURL,u=h.createObjectURL(e);r?r.location=u:location.href=u,r=null,setTimeout((function(){h.revokeObjectURL(u)}),4e4)}});i.saveAs=o.saveAs=o,e.exports=o})?n.apply(t,r):n)||(e.exports=a)},5736:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var n=s(1694),r=s.n(n),a=s(2791),i=s(162),c=s(184);const o=a.forwardRef(((e,t)=>{let{bsPrefix:s,bg:n="primary",pill:a=!1,text:o,className:l,as:d="span",...h}=e;const u=(0,i.vE)(s,"badge");return(0,c.jsx)(d,{ref:t,...h,className:r()(l,u,a&&"rounded-pill",o&&`text-${o}`,n&&`bg-${n}`)})}));o.displayName="Badge";const l=o},2591:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(1694),r=s.n(n),a=s(2791),i=s(162),c=s(184);const o=a.forwardRef(((e,t)=>{let{bsPrefix:s,className:n,striped:a,bordered:o,borderless:l,hover:d,size:h,variant:u,responsive:m,...x}=e;const j=(0,i.vE)(s,"table"),f=r()(n,j,u&&`${j}-${u}`,h&&`${j}-${h}`,a&&`${j}-${"string"===typeof a?`striped-${a}`:"striped"}`,o&&`${j}-bordered`,l&&`${j}-borderless`,d&&`${j}-hover`),v=(0,c.jsx)("table",{...x,className:f,ref:t});if(m){let e=`${j}-responsive`;return"string"===typeof m&&(e=`${e}-${m}`),(0,c.jsx)("div",{className:e,children:v})}return v}))}}]);
//# sourceMappingURL=871.1691833d.chunk.js.map